#!/usr/bin/env bash
set -e

PYTHON="${PYTHON:-python3.9}"
PREFIX="${PREFIX:-.venv}"

if [ -f poetry.lock ]; then
  poetry install || exit
else
  # Make a python virtualenv
  ${PYTHON} -m venv ${PREFIX}
  PATH=${PREFIX}:$PATH
fi

# Install useful tools
${PREFIX}/bin/${PYTHON} -m \
    pip install \
      black \
      flake8 \
      mypy \
      isort \
      pytest \
      pytest-cov \
      pytest-mock

[[ -f requirements.txt ]] &&  \
    ${PREFIX}/bin/${PYTHON} -m \
        pip install -r requirements.txt
