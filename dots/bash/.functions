#!/bin/bash
if (sudo -nv &> /dev/null); then
  sudo="sudo"
else
  sudo=""
fi

# Find things in internal history
bh() { grep -a "$@" ${HOME}/.bash_history*; }

# folder contents
l() {
  clear;
  pwd;
  heading="============================================================================"
  heading+=$heading
  heading+=$heading
  echo ${heading::$COLUMNS}
  /usr/bin/ls -C $@;
}

# ----------------------------------
# ANSI Color Ref
# Format: $green = "\033[01;32m";
function c() { echo -ne "\[\033[0$1m\]"; }
function colors() {
  #Background
  for clbg in {40..47} {100..107} 49 ; do
    #Foreground
    for clfg in {30..37} {90..97} 39 ; do
      #Formatting
      for attr in 0 1 2 4 5 7 ; do
        #Print the result
        echo -en "\e[${attr};${clbg};${clfg}m ^[${attr};${clbg};${clfg}m \e[0m"
      done
      echo #Newline
    done
  done
  #Foreground
  for fgbg in 38 48 ; do # Foreground / Background
    for color in {0..255} ; do # Colors
        # Display the color
        printf "\e[${fgbg};5;%sm  %3s  \e[0m" $color $color
        # Display 6 colors per lines
        if [ $((($color + 1) % 6)) == 4 ] ; then
            echo # New line
        fi
    done
    echo # New line
done
}
# ----------------------------------

function task_active {
  MSG=""
  MSG+="$(task _ids +ACTIVE): "
  MSG+="$(task _get $(task _ids +ACTIVE).description)"
  echo $MSG
}

# Delete python leftovers
pyclean() {
  sudo find ${PWD} -regextype posix-extended -regex '^.*(__pycache__|pytest_cache|\.pyc|\.pyo$)' -delete;
}

# Search files
search() {
  find . -type f \
    -not -ipath "*python*" \
    -not -ipath "*node_modules*" \
    -not -ipath "*aws-sam*" \
    -not -ipath "*tests*" \
    -not -ipath "*.venv*" \
    -not -ipath "*.git*" \
    -printf "%T@ %Td-%Tb-%TY %Tk:%Tm %p\n" \
    | sort -rn | tr -s ' ' | cut -d " " -f 4- |
    xargs -I % grep -i --color=always $@ % /dev/null
}

# Run newman using docker
__newman() {
  docker run --rm -it -v "${PWD}":/etc/newman -t postman/newman:alpine "$@";
}

# Run AWS CLI using docker
__aws() {
  docker run --rm -it -v ${HOME}/.aws:/root/.aws -v ${PWD}:/aws -e AWS_REGION -e AWS_PROFILE amazon/aws-cli:latest "$@";
}

# Flash the screen after 25mins (1500s)
pomo() {
  sleep ${1:-1500}; for x in $(seq 1 60); do printf '\a'; sleep 1; done
}

# Cheatsheet
cht() {
  selected=$(curl -ks cht.sh/:list | ~/.vim/plugged/fzf/bin/fzf --preview 'curl -ks cht.sh/{}' -q "$*")
  if [[ -n "$selected" ]]; then
    curl -ks cht.sh/$selected
  fi
}
